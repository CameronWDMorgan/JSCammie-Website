<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buy Credits - AI Image Generator Shop | JSCammie.com</title>
    <meta name="description" content="Purchase credits for JSCammie's AI image generator. Unlock premium features, generate more images, and enhance your AI art creation experience.">
    <meta name="keywords" content="buy credits, ai generator credits, paypal shop, premium features, jscammie credits, ai art subscription">
    <meta name="author" content="JSCammie">
    
    <!-- Open Graph meta tags for social media -->
    <meta property="og:title" content="Buy Credits - AI Image Generator Shop | JSCammie.com">
    <meta property="og:description" content="Purchase credits for JSCammie's AI image generator. Unlock premium features, generate more images, and enhance your AI art creation experience.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://jscammie.com/paypal-shop">
    <meta property="og:site_name" content="JSCammie.com">
    
    <!-- Twitter Card meta tags -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Buy Credits - AI Image Generator Shop | JSCammie.com">
    <meta name="twitter:description" content="Purchase credits for JSCammie's AI image generator. Unlock premium features, generate more images, and enhance your AI art creation experience.">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://jscammie.com/paypal-shop">
    
    <link rel='stylesheet' href='/style.css'/>
    <%- include('../partials/_headerAll') %>

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-K3KJJKS1R4"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-K3KJJKS1R4');
    </script>
</head>
<body>

    <%- include('../partials/_navigation') %>
    
    <div class="center-fully-no-flex" style="margin-bottom: 1rem;">
        <%- include('../partials/_bannerAdvert') %>
    </div>

    <div class="round-frosted page-content shop-container">
        <div class="shop-header">
            <h1>Credits Shop</h1>
            <p class="shop-tagline">Purchase credits to unlock the full potential of our AI Image Generator!</p>
        </div>

        <style>
            .shop-container {
                padding: 40px;
                display: flex;
                flex-direction: column;
                align-items: center;
                margin: 0 auto;
                width: 95%;
                max-width: 80%;
                margin-left: auto;
                margin-right: auto;
            }

            .shop-header {
                text-align: center;
                margin-bottom: 20px;
                width: 100%;
            }

            .shop-header h1 {
                font-size: 2.5rem;
                margin-bottom: 10px;
                background: linear-gradient(135deg, #ff9966, #ff5e62);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
            }

            .shop-tagline {
                font-size: 1.2rem;
                opacity: 0.9;
                max-width: 600px;
                margin: 0 auto;
            }

            .user-status {
                padding: 12px 24px;
                background: rgba(255, 255, 255, 0.1);
                border-radius: 50px;
                margin: 10px 0 20px;
                font-weight: 500;
                display: inline-flex;
                align-items: center;
                gap: 8px;
            }

            .user-status:before {
                content: "";
                display: inline-block;
                width: 10px;
                height: 10px;
                border-radius: 50%;
                background: #4CAF50;
            }

            .not-logged-in .user-status:before {
                background: #F44336;
            }

            #paypal-buttons-container {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
                gap: 30px;
                width: 100%;
                max-width: 1200px;
            }

            #paypal-buttons-container > div {
                padding: 30px;
                border-radius: 16px;
                background: rgba(43, 0, 43, 0.4);
                color: rgb(255, 255, 255);
                box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
                text-align: center;
                transition: all 0.4s ease-in-out;
                border: 2px solid rgba(255, 255, 255, 0.2);
                position: relative;
                overflow: hidden;
                display: flex;
                flex-direction: column;
                justify-content: space-between;
            }

            #paypal-buttons-container > div:before {
                content: "";
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0) 100%);
                pointer-events: none;
                z-index: 1;
            }

            #paypal-buttons-container > div:hover {
                transform: translateY(-10px);
                box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
                border-color: rgba(255, 255, 255, 0.5);
            }

            #paypal-buttons-container h3 {
                margin: 0 0 15px;
                font-size: 1.8em;
                font-weight: 700;
                background: linear-gradient(135deg, #c2e59c, #64b3f4);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                position: relative;
                z-index: 2;
            }

            .value-badge {
                position: absolute;
                top: 0;
                right: 0;
                background: linear-gradient(135deg, #ff9966, #ff5e62);
                padding: 8px 14px;
                border-radius: 0 16px 0 16px;
                font-size: 1.1em;
                font-weight: bold;
                z-index: 2;
                box-shadow: -2px 2px 10px rgba(0, 0, 0, 0.2);
            }

            #paypal-buttons-container p {
                margin: 0 0 20px;
                font-size: 1.3em;
                font-weight: 600;
                position: relative;
                z-index: 2;
            }

            #paypal-buttons-container p:after {
                content: "";
                display: block;
                width: 40px;
                height: 3px;
                background: linear-gradient(90deg, #64b3f4, transparent);
                margin: 15px auto 0;
            }

            /* Disable PayPal buttons if not logged in */
            .disabled-paypal {
                pointer-events: none;
                opacity: 0.5;
            }

            .login-cta {
                margin-top: 30px;
                padding: 15px 30px;
                background: linear-gradient(135deg, #ff9966, #ff5e62);
                border-radius: 50px;
                font-weight: 600;
                font-size: 1.1em;
                text-decoration: none;
                display: inline-block;
                transition: all 0.3s ease;
                box-shadow: 0 5px 15px rgba(255, 94, 98, 0.4);
            }

            .login-cta:hover {
                transform: translateY(-3px);
                box-shadow: 0 8px 20px rgba(255, 94, 98, 0.6);
            }

            @media (min-width: 1200px) {
                #paypal-buttons-container {
                    grid-template-columns: repeat(3, 1fr);
                    max-width: 100%;
                }
            }

            @media (max-width: 768px) {
                .shop-container {
                    padding: 20px;
                    width: 95%;
                }
                
                .shop-header h1 {
                    font-size: 2rem;
                }
                
                #paypal-buttons-container {
                    grid-template-columns: 1fr;
                }
            }
        </style>

        <% if (session.accountId) { %>
            <div class="user-status">Logged in as: <%= userProfile.username %></div>
            <div id="paypal-buttons-container"></div>
        <% } else { %>
            <div class="not-logged-in">
                <div class="user-status">Not logged in</div>
                <p>You need to be logged in to purchase credits</p>
                <div id="paypal-buttons-container" class="disabled-paypal"></div>
                <a href="/login" class="login-cta">Log in to purchase</a>
            </div>
            <script>
            
                // disable tab input to prevent clicking on disabled buttons
                document.addEventListener('keydown', function(e) {
                    if (e.key === 'Tab') {
                        e.preventDefault();
                    }
                });

                // disable any other methods of clicking on disabled buttons:
                const disabledButtons = document.querySelectorAll('.disabled-paypal');
                disabledButtons.forEach(button => {
                    button.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                    });
                });

            
            </script>
        <% } %>

        <script>
            const creditOptions = [
                { credits: 17500, price: 5 },
                { credits: 40000, price: 10 },
                { credits: 100000, price: 20 }
            ];

            // Calculate value (credits per dollar) for each option
            creditOptions.forEach((option, index) => {
                option.value = option.credits / option.price;
            });

            creditOptions.forEach((option, index) => {
                const buttonContainer = document.createElement('div');
                buttonContainer.id = `paypal-button-${option.credits}`;
                
                // Calculate value increase percentage compared to previous option
                let valueComparisonHtml = '';
                if (index > 0) {
                    const prevOption = creditOptions[index-1];
                    const valueIncrease = ((option.value - prevOption.value) / prevOption.value) * 100;
                    valueComparisonHtml = `<span class="value-badge">+${valueIncrease.toFixed(0)}% Extra</span>`;
                }
                
                buttonContainer.innerHTML = `
                    ${valueComparisonHtml}
                    <h3>${option.credits.toLocaleString()} Credits</h3>
                    <p>Price: $${option.price.toFixed(2)}</p>
                `;
                document.getElementById('paypal-buttons-container').appendChild(buttonContainer);

                paypal.Buttons({
                    createOrder: (data, actions) => actions.order.create({
                        purchase_units: [{
                            amount: { value: option.price.toFixed(2) },
                            custom_id: '<%= session.accountId %>'
                        }]
                    }),
                    onApprove: (data, actions) => {
                        return actions.order.capture().then(details => {
                            fetch('/payment/verify', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({
                                    orderId: details.id,
                                    accountId: '<%= session.accountId %>',
                                    credits: option.credits,
                                    amount: option.price
                                })
                            }).then(response => {
                                if (response.ok) {
                                    alert(`Successfully added ${option.credits.toLocaleString()} credits!`);
                                } else {
                                    alert('Payment verification failed. Please contact JSCammie on Discord or email.');
                                }
                            });
                        });
                    },
                    onError: (err) => {
                        console.error(`PayPal error for ${option.credits} credits:`, err);
                        alert('Payment could not be completed. Please contact JSCammie on Discord or email.');
                    },
                    style: {
                        shape: 'pill',
                        color: 'blue',
                        layout: 'vertical',
                        label: 'pay',
                        height: 40,
                    }
                }).render(`#paypal-button-${option.credits}`);
            });
        </script>
    </div>

    <%- include('../partials/_footer') %>
</body>
</html>
